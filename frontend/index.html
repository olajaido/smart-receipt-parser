<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Receipt Parser - Live System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .demo-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            align-items: start;
        }

        .upload-section, .results-section {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-content {
            padding: 30px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
            margin-bottom: 30px;
            position: relative;
        }

        .upload-area:hover {
            border-color: #5a67d8;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #4c51bf;
            background: #e6fffa;
            transform: scale(1.02);
        }

        .upload-area.uploading {
            border-color: #48bb78;
            background: #f0fff4;
            pointer-events: none;
        }

        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .upload-subtext {
            font-size: 1rem;
            color: #718096;
        }

        .file-input {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .progress-bar.visible {
            opacity: 1;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-select {
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .refresh-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .refresh-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .receipts-grid {
            display: grid;
            gap: 20px;
        }

        .receipt-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .receipt-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .receipt-card.new {
            animation: slideIn 0.5s ease-out;
            border-color: #48bb78;
            background: #f0fff4;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .receipt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .receipt-vendor {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2d3748;
        }

        .receipt-amount {
            font-size: 1.4rem;
            font-weight: bold;
            color: #48bb78;
        }

        .receipt-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .receipt-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            color: #4a5568;
        }

        .receipt-detail i {
            width: 16px;
            text-align: center;
            color: #667eea;
        }

        .category-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-food { background: #c6f6d5; color: #22543d; }
        .category-travel { background: #bee3f8; color: #2a4365; }
        .category-office { background: #fbb6ce; color: #702459; }
        .category-fuel { background: #fbd38d; color: #744210; }
        .category-healthcare { background: #c4b5fd; color: #44337a; }
        .category-entertainment { background: #f687b3; color: #702459; }
        .category-equipment { background: #fed7d7; color: #742a2a; }
        .category-other { background: #cbd5e0; color: #2d3748; }

        .confidence-section {
            margin-top: 15px;
        }

        .confidence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f56565 0%, #ed8936 50%, #48bb78 100%);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        /* NEW: Line Items Styles */
        .line-items-section {
            margin-top: 20px;
            border-top: 2px solid #e2e8f0;
            padding-top: 20px;
        }

        .view-details-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .view-details-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .line-items-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .line-items-table th {
            background: #f7fafc;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
        }

        .line-items-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e2e8f0;
            color: #2d3748;
        }

        .line-items-table tr:hover {
            background: #f7fafc;
        }

        .line-items-summary {
            margin-top: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .line-items-summary .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .line-items-summary .summary-row.total {
            font-weight: bold;
            font-size: 1rem;
            border-top: 1px solid #e2e8f0;
            padding-top: 10px;
            margin-top: 10px;
        }

        .detailed-badge {
            background: #c6f6d5;
            color: #22543d;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #667eea;
        }

        .loading i {
            font-size: 3rem;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error, .success {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #38a169;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #718096;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .method-badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 12px;
            background: #edf2f7;
            color: #4a5568;
            margin-top: 10px;
            display: inline-block;
        }

        .new-badge {
            background: #c6f6d5;
            color: #22543d;
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .receipt-details {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .line-items-table th,
            .line-items-table td {
                padding: 8px 4px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Your actual working API URL
        const API_BASE_URL = 'https://fej2nyr8nk.execute-api.eu-west-2.amazonaws.com/prod';

        const ReceiptParser = () => {
            const [receipts, setReceipts] = useState([]);
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(false);
            const [uploading, setUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState(0);
            const [error, setError] = useState('');
            const [success, setSuccess] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('');
            const [dragOver, setDragOver] = useState(false);
            const [newReceiptIds, setNewReceiptIds] = useState(new Set());
            const [expandedReceipts, setExpandedReceipts] = useState(new Set());

            // Fetch receipts from your working API
            const fetchReceipts = useCallback(async (category = '') => {
                try {
                    setLoading(true);
                    setError('');
                    
                    const url = category 
                        ? `${API_BASE_URL}/receipts/category/${category}`
                        : `${API_BASE_URL}/receipts`;
                    
                    console.log('Fetching from:', url);
                    const response = await axios.get(url);
                    const data = response.data;
                    
                    setReceipts(data.receipts || []);
                    setStats(data.stats || null);
                    
                    console.log('Loaded receipts:', data.receipts?.length || 0);
                } catch (err) {
                    console.error('API Error:', err);
                    setError(`Failed to fetch receipts: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            }, []);

            // Load receipts on mount
            useEffect(() => {
                fetchReceipts();
            }, [fetchReceipts]);

            // Handle real file upload with pre-signed URLs
            const handleFileUpload = async (file) => {
                if (!file || !file.type.startsWith('image/')) {
                    setError('Please select an image file (JPG, PNG, GIF, etc.)');
                    return;
                }

                try {
                    setUploading(true);
                    setError('');
                    setSuccess('');
                    setUploadProgress(0);

                    // Step 1: Get pre-signed upload URL from API
                    setSuccess(`ðŸ”— Getting secure upload URL...`);
                    setUploadProgress(25);
                    
                    const uploadResponse = await axios.post(
                        `${API_BASE_URL}/upload`,
                        {
                            filename: file.name,
                            contentType: file.type
                        }
                    );

                    const { uploadUrl, key, filename } = uploadResponse.data;
                    console.log('Got upload URL for:', filename);

                    // Step 2: Upload file directly to S3
                    setSuccess(`ðŸ“¤ Uploading "${file.name}" to AWS S3...`);
                    setUploadProgress(50);
                    
                    await axios.put(uploadUrl, file, {
                        headers: {
                            'Content-Type': file.type
                        },
                        onUploadProgress: (progressEvent) => {
                            const progress = Math.round(
                                50 + (progressEvent.loaded / progressEvent.total) * 30
                            );
                            setUploadProgress(progress);
                        }
                    });

                    // Step 3: Upload successful
                    setSuccess(`âœ… Upload successful! Processing with AWS Textract + Claude AI...`);
                    setUploadProgress(85);
                    
                    console.log('File uploaded successfully to:', key);

                    // Step 4: Auto-refresh after processing delay
                    setTimeout(async () => {
                        setSuccess('ðŸ”„ Checking for processed results...');
                        setUploadProgress(100);
                        
                        // Refresh data
                        await fetchReceipts(selectedCategory);
                        
                        setSuccess('ðŸŽ‰ Receipt processed successfully! Check the results below.');
                        
                        // Clear success message after 5 seconds
                        setTimeout(() => {
                            setSuccess('');
                            setUploadProgress(0);
                        }, 5000);
                        
                    }, 8000); // Give Lambda time to process

                } catch (err) {
                    console.error('Upload error:', err);
                    const errorMessage = err.response?.data?.error || err.message;
                    setError(`Upload failed: ${errorMessage}`);
                    setUploadProgress(0);
                } finally {
                    setUploading(false);
                }
            };

            // Drag and drop handlers
            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setDragOver(false);
            };

            const handleFileChange = (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            };

            const handleCategoryChange = (e) => {
                const category = e.target.value;
                setSelectedCategory(category);
                fetchReceipts(category);
            };

            // Toggle line items display
            const toggleLineItems = (receiptId) => {
                const newExpanded = new Set(expandedReceipts);
                if (newExpanded.has(receiptId)) {
                    newExpanded.delete(receiptId);
                } else {
                    newExpanded.add(receiptId);
                }
                setExpandedReceipts(newExpanded);
            };

            // Utility functions
            const formatCurrency = (amount, currency = 'GBP') => {
                const symbol = currency === 'USD' ? '$' : currency === 'EUR' ? 'â‚¬' : 'Â£';
                return `${symbol}${parseFloat(amount).toFixed(2)}`;
            };

            const getCategoryClass = (category) => {
                return `category-badge category-${category.toLowerCase()}`;
            };

            const formatDate = (dateString) => {
                if (!dateString) return 'Unknown date';
                return new Date(dateString).toLocaleDateString('en-GB');
            };

            const formatTimestamp = (timestamp) => {
                return new Date(timestamp).toLocaleString('en-GB');
            };

            const isNewReceipt = (receipt) => {
                const uploadTime = new Date(receipt.uploadTimestamp);
                const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);
                return uploadTime > fiveMinutesAgo;
            };

            const categories = ['Food', 'Travel', 'Office', 'Fuel', 'Healthcare', 'Entertainment', 'Equipment', 'Other'];

            return (
                <div className="container">
                    <div className="header">
                        <h1><i className="fas fa-receipt"></i> Smart Receipt Parser</h1>
                        <p>AI-Powered Receipt Processing with Real Upload & Processing</p>
                        <div className="demo-badge">
                            <i className="fas fa-bolt"></i> Live System - Real AI Processing
                        </div>
                    </div>

                    {error && (
                        <div className="error">
                            <i className="fas fa-exclamation-triangle"></i>
                            {error}
                        </div>
                    )}
                    
                    {success && (
                        <div className="success">
                            <i className="fas fa-check-circle"></i>
                            {success}
                        </div>
                    )}

                    <div className="main-content">
                        {/* Upload Section */}
                        <div className="upload-section">
                            <div className="section-header">
                                <div className="section-title">
                                    <i className="fas fa-cloud-upload-alt"></i>
                                    Upload Receipt
                                </div>
                            </div>
                            
                            <div className="section-content">
                                <div
                                    className={`upload-area ${dragOver ? 'dragover' : ''} ${uploading ? 'uploading' : ''}`}
                                    onDrop={handleDrop}
                                    onDragOver={handleDragOver}
                                    onDragLeave={handleDragLeave}
                                    onClick={() => !uploading && document.getElementById('fileInput').click()}
                                >
                                    <div className="upload-icon">
                                        <i className={`fas ${uploading ? 'fa-cog fa-spin' : 'fa-camera'}`}></i>
                                    </div>
                                    <div className="upload-text">
                                        {uploading ? 'Processing Upload...' : 'Drop receipt image here or click to browse'}
                                    </div>
                                    <div className="upload-subtext">
                                        {uploading ? 'Please wait while we process your receipt' : 'Real upload to AWS S3 â€¢ Any image format â€¢ Universal processing'}
                                    </div>
                                    
                                    <div className={`progress-bar ${uploading ? 'visible' : ''}`}>
                                        <div 
                                            className="progress-fill" 
                                            style={{width: `${uploadProgress}%`}}
                                        ></div>
                                    </div>
                                </div>
                                
                                <input
                                    id="fileInput"
                                    type="file"
                                    className="file-input"
                                    accept="image/*"
                                    onChange={handleFileChange}
                                    disabled={uploading}
                                />

                                {stats && (
                                    <div>
                                        <h3 style={{marginBottom: '20px', color: '#2d3748', fontSize: '1.1rem'}}>
                                            <i className="fas fa-chart-pie"></i> Live Statistics
                                        </h3>
                                        <div className="stats-grid">
                                            <div className="stat-card">
                                                <div className="stat-value">{stats.total_count}</div>
                                                <div className="stat-label">Receipts Processed</div>
                                            </div>
                                            <div className="stat-card">
                                                <div className="stat-value">{formatCurrency(stats.total_amount)}</div>
                                                <div className="stat-label">Total Amount</div>
                                            </div>
                                            <div className="stat-card">
                                                <div className="stat-value">{formatCurrency(stats.average_amount)}</div>
                                                <div className="stat-label">Average Amount</div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Results Section */}
                        <div className="results-section">
                            <div className="section-header">
                                <div className="section-title">
                                    <i className="fas fa-list-alt"></i>
                                    Processed Receipts ({receipts.length})
                                </div>
                            </div>
                            
                            <div className="section-content">
                                <div className="filters">
                                    <select 
                                        className="filter-select"
                                        value={selectedCategory}
                                        onChange={handleCategoryChange}
                                    >
                                        <option value="">All Categories</option>
                                        {categories.map(cat => (
                                            <option key={cat} value={cat}>{cat}</option>
                                        ))}
                                    </select>
                                    
                                    <button 
                                        className="refresh-btn"
                                        onClick={() => fetchReceipts(selectedCategory)}
                                        disabled={loading}
                                    >
                                        <i className={`fas fa-sync-alt ${loading ? 'fa-spin' : ''}`}></i>
                                        Refresh
                                    </button>
                                </div>

                                {loading ? (
                                    <div className="loading">
                                        <i className="fas fa-cog"></i>
                                        <p>Loading receipts from API...</p>
                                    </div>
                                ) : receipts.length === 0 ? (
                                    <div className="empty-state">
                                        <i className="fas fa-inbox"></i>
                                        <p>No receipts found for this category.</p>
                                        <p>Upload a receipt above to see real AI processing!</p>
                                    </div>
                                ) : (
                                    <div className="receipts-grid">
                                        {receipts.map((receipt) => (
                                            <div 
                                                key={receipt.receiptId} 
                                                className={`receipt-card ${isNewReceipt(receipt) ? 'new' : ''}`}
                                            >
                                                <div className="receipt-header">
                                                    <div>
                                                        <div className="receipt-vendor">
                                                            {receipt.vendor}
                                                            {receipt.hasDetailedItems && (
                                                                <span className="detailed-badge">
                                                                    <i className="fas fa-list"></i> DETAILED
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div className="receipt-amount">
                                                            {formatCurrency(receipt.amount, receipt.currency)}
                                                        </div>
                                                    </div>
                                                    <span className={getCategoryClass(receipt.category)}>
                                                        {receipt.category}
                                                    </span>
                                                </div>
                                                
                                                <div className="receipt-details">
                                                    <div className="receipt-detail">
                                                        <i className="fas fa-calendar-alt"></i>
                                                        <span>Receipt: {formatDate(receipt.receiptDate)}</span>
                                                    </div>
                                                    <div className="receipt-detail">
                                                        <i className="fas fa-clock"></i>
                                                        <span>Processed: {formatTimestamp(receipt.uploadTimestamp)}</span>
                                                    </div>
                                                    <div className="receipt-detail">
                                                        <i className="fas fa-money-bill-wave"></i>
                                                        <span>Currency: {receipt.currency}</span>
                                                    </div>
                                                    <div className="receipt-detail">
                                                        <i className="fas fa-file-image"></i>
                                                        <span>Source: {receipt.s3Key.split('/').pop()}</span>
                                                    </div>
                                                </div>

                                                <div className="confidence-section">
                                                    <div className="confidence-header">
                                                        <span><i className="fas fa-brain"></i> AI Confidence:</span>
                                                        <span>{Math.round(receipt.confidence * 100)}%</span>
                                                    </div>
                                                    <div className="confidence-bar">
                                                        <div 
                                                            className="confidence-fill" 
                                                            style={{width: `${receipt.confidence * 100}%`}}
                                                        ></div>
                                                    </div>
                                                </div>

                                                {/* NEW: Line Items Section */}
                                                {receipt.hasDetailedItems && receipt.lineItems && receipt.lineItems.length > 0 && (
                                                    <div className="line-items-section">
                                                        <button 
                                                            className="view-details-btn"
                                                            onClick={() => toggleLineItems(receipt.receiptId)}
                                                        >
                                                            <i className={`fas ${expandedReceipts.has(receipt.receiptId) ? 'fa-chevron-up' : 'fa-chevron-down'}`}></i>
                                                            {expandedReceipts.has(receipt.receiptId) ? 'Hide' : 'View'} {receipt.lineItems.length} Line Items
                                                        </button>

                                                        {expandedReceipts.has(receipt.receiptId) && (
                                                            <div>
                                                                <table className="line-items-table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Description</th>
                                                                            <th>Qty</th>
                                                                            <th>Unit Price</th>
                                                                            <th>Subtotal</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {receipt.lineItems.map((item, index) => (
                                                                            <tr key={index}>
                                                                                <td>{item.description}</td>
                                                                                <td>{item.quantity}</td>
                                                                                <td>{formatCurrency(item.unitPrice, receipt.currency)}</td>
                                                                                <td>{formatCurrency(item.subtotal, receipt.currency)}</td>
                                                                            </tr>
                                                                        ))}
                                                                    </tbody>
                                                                </table>

                                                                <div className="line-items-summary">
                                                                    {receipt.subtotal && (
                                                                        <div className="summary-row">
                                                                            <span>Subtotal:</span>
                                                                            <span>{formatCurrency(receipt.subtotal, receipt.currency)}</span>
                                                                        </div>
                                                                    )}
                                                                    {receipt.totalTax && (
                                                                        <div className="summary-row">
                                                                            <span>Tax:</span>
                                                                            <span>{formatCurrency(receipt.totalTax, receipt.currency)}</span>
                                                                        </div>
                                                                    )}
                                                                    <div className="summary-row total">
                                                                        <span>Total:</span>
                                                                        <span>{formatCurrency(receipt.amount, receipt.currency)}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}

                                                <div className={`method-badge ${isNewReceipt(receipt) ? 'new-badge' : ''}`}>
                                                    <i className="fas fa-cogs"></i> {receipt.processingMethod}
                                                    {isNewReceipt(receipt) && <span> â€¢ NEW</span>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ReceiptParser />, document.getElementById('root'));
    </script>
</body>
</html>